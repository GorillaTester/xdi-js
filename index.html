<html>

<head>

<title>xdi-js</title>

<link rel="shortcut icon" href="favicon.ico" />

<link rel="stylesheet" href="css/style.css" TYPE="text/css" MEDIA="screen">
<link rel="stylesheet" href="css/jquery-ui-1.10.3.custom.min.css" />

<script type="text/javascript" src="js/jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.10.3.custom.min.js"></script>
<script type="text/javascript" src="js/lodash.compat.min.js"></script>
<script type="text/javascript" src="xdi.js"></script>

<script type="text/javascript">

function syntax() {

	var statement = xdi.parser.parseStatement($("#syntaxinput").val());

	var type = null;
	if (statement.isContextNodeStatement()) type = "context node";
	if (statement.isRelationStatement()) type = "relation";
	if (statement.isLiteralStatement()) type = "literal";

	$("#syntaxresult").html("");
	$("#syntaxresult").append("<p class='segment'>STATEMENT TYPE:&nbsp;" + _.escape(type) + "</p>");
	$("#syntaxresult").append("<p class='segment'>SUBJECT:&nbsp;" + _.escape(statement.subject.string) + "</p>");
	for (var subsegment in statement.subject.subsegments) $("#syntaxresult").append("<p class='subsegment'>" + _.escape(statement.subject.subsegments[subsegment].string) + "</p>");
	$("#syntaxresult").append("<p class='segment'>PREDICATE:&nbsp;" + _.escape(statement.predicate.string) + "</p>");
	for (var subsegment in statement.predicate.subsegments) $("#syntaxresult").append("<p class='subsegment'>" + _.escape(statement.predicate.subsegments[subsegment].string) + "</p>");
	$("#syntaxresult").append("<p class='segment'>OBJECT:&nbsp;" + _.escape(statement.object.string || JSON.stringify(statement.object)) + "</p>");
	if ((statement.object.subsegments) !== "undefined") for (var subsegment in statement.object.subsegments) $("#syntaxresult").append("<p class='subsegment'>" + _.escape(statement.object.subsegments[subsegment].string) + "</p>");
}

function syntaxclear() {

	$("#syntaxresult").html("");
}

function graph() {

	eval($("#graphinput").val());
	
	var statements = g.statements();

	$("#graphresult").html("");
	$("#graphresult").append("<p class='segment'>STATEMENTS: " + statements.length + "</p>");
	for (var i in statements) $("#graphresult").append("<p class='graph'>" + _.escape(statements[i].string) + "</p>");
}

function graphclear() {

	$("#graphresult").html("");
}

function client() {

	var endpoint = $("#clientinput").val();
	var message = xdi.io.read($("#clientinput2").val());

	$.ajax(
		endpoint,
		{
			accepts: {
				text: "text/xdi"
			},
			dataType: "text",
			contentType: "text/xdi",
			type: "POST",
			processData: false,
			data: xdi.io.write(message),
			success: function(data) {
				var statements = xdi.io.read(data).statements();
				$("#clientresult").html("");
				$("#clientresult").append("<p class='segment'>STATEMENTS: " + statements.length + "</p>");
				for (var i in statements) $("#clientresult").append("<p class='graph'>" + _.escape(statements[i].string) + "</p><br>");
			},
			error: function(jqXHR, textStatus, errorThrown) {
				alert(textStatus + " / " + errorThrown);
			}
		}
	);
}

function clientclear() {

	$("#clientresult").html("");
}

function discovery() {

	var xri = xdi.parser.parseSegment($("#discoveryinput").val());

	var endpoint = "http://mycloud.neustar.biz:12220/";
	var message = xdi.graph();
	message.statement("$anon[$msg]!1/$do/$public");
	message.statement("$anon[$msg]!1$do/$get/(" + xri.string + ")");

	$.ajax(
		endpoint,
		{
			accepts: {
				text: "text/xdi"
			},
			dataType: "text",
			contentType: "text/xdi",
			type: "POST",
			processData: false,
			data: xdi.io.write(message),
			success: function(data) {
				var statements = xdi.io.read(data).statements();
				$("#discoveryresult").html("");
				$("#discoveryresult").append("<p class='segment'>STATEMENTS: " + statements.length + "</p>");
				for (var i in statements) $("#discoveryresult").append("<p class='graph'>" + _.escape(statements[i].string) + "</p><br>");
			},
			error: function(jqXHR, textStatus, errorThrown) {
				alert(textStatus + " / " + errorThrown);
			}
		}
	);
}

function discoveryclear() {

	$("#discoveryresult").html("");
}

$(function() {

	$( "#tabs" ).tabs();
});

</script>

</head>

<body>

<div id="tabs">

<ul>
<li><a href="#tabs-1"><img src="images/logo64.png"></a></li>
<li><a href="#tabs-2">Syntax</a></li>
<li><a href="#tabs-3">Graph</a></li>
<li><a href="#tabs-4">Client</a></li>
<li><a href="#tabs-5">Discovery</a></li>
</ul>

<div id="tabs-1">
<p>This is a JavaScript library for XDI. See here for more information:</p>
<p><a href="http://github.com/projectdanube/xdi-js">http://github.com/projectdanube/xdi-js</a></p>
</div>

<div id="tabs-2">
<input type="text" id="syntaxinput" size="50" value='[=]!1111[+address]!1<+street>&/&/"MyStreet123"'>
<button onclick="syntax();">Syntax</button>
<button onclick="syntaxclear();">Clear</button>
<div class="result" id="syntaxresult"></div>
</div>

<div id="tabs-3">
<textarea id="graphinput" cols="120" rows="8">
var g = xdi.graph();
g.root().context("=markus").context("<+email>").context("&").literal("markus.sabadello@gmail.com");
g.root().context("=markus").relation("+friend", "=joe");
g.root().context("=markus").relation("+friend", "=drummond");
g.root().context("=markus").context("+first").context("<+name>").context("&").literal("Markus");
g.statement("=markus+last<+name>&/&/\"Sabadello\"");
g.statement("=x/+y/(=a/+b/=c)");
</textarea>
<button onclick="graph();">Graph</button>
<button onclick="graphclear();">Clear</button>
<div class="result" id="graphresult"></div>
</div>

<div id="tabs-4">
<p><input type="text" id="clientinput" size="50" value='http://mycloud.neustar.biz:14440/users/%5B%40%5D%21%3Auuid%3Ae0178407-b7b6-43f9-e017-8407b7b643f9'></p>
<textarea id="clientinput2" cols="120" rows="8">
$anon[$msg]!1/$do/$public$do
$anon[$msg]!1/$is()/([@]!:uuid:e0178407-b7b6-43f9-e017-8407b7b643f9)
$anon[$msg]!1$do/$get/@acmebread<+name>
</textarea>
<button onclick="client();">Client</button>
<button onclick="clientclear();">Clear</button>
<div class="result" id="clientresult"></div>
</div>

<div id="tabs-5">
<input type="text" id="discoveryinput" size="50" value='@acmebread'>
<button onclick="discovery();">Discovery</button>
<button onclick="discoveryclear();">Clear</button>
<div class="result" id="discoveryresult"></div>
</div>

</div>

</body>

</html>
